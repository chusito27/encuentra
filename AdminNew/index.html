<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrador de Menú</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <h1>Administrador</h1>
        </div>
        <div id="comercioSelector">
            <label for="selectComercio">Comercio:</label>
            <select id="selectComercio">
                <option value="">-- Seleccione --</option>
            </select>
            <div id="comercioActions"></div> <!-- Container for edit/delete buttons -->
        </div>
        <div class="auth-buttons-container">
            <div id="currentComercioInfo"></div>
            <button id="openAuthModalButton">Iniciar Sesión</button>
            <button id="signOutButton" style="display: none;">Cerrar Sesión</button>
        </div>
    </header>

    <div class="main-layout">
        <nav class="sidebar">
            <h3>Módulos</h3>
            <button class="sidebar-button active" onclick="openTab('inicio')">Inicio</button>
            <button class="sidebar-button" onclick="openTab('comercio-gestion')">Comercios</button>
            <button class="sidebar-button" onclick="openTab('products')">Productos</button>
            <button class="sidebar-button" onclick="openTab('categories')">Categorías</button>
            <button class="sidebar-button" onclick="openTab('usuarios')">Usuarios</button>
        </nav>

        <div class="main-content">
            <div class="container">
                <div id="inicio" class="tab-content active">
                    <h2>Bienvenido al Panel de Administración</h2>
                    <p>Selecciona un módulo de la izquierda para comenzar a trabajar.</p>
                    <p>Si necesitas gestionar un comercio específico, asegúrate de seleccionarlo en el menú de la parte superior.</p>
                </div>

                <div id="comercio-gestion" class="tab-content">
                    <div class="form-section">
                        <h2>Añadir/Editar Comercio</h2>
                        <form id="comercioForm">
                            <input type="hidden" id="comercioId">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="comercioName">Nombre del Comercio</label>
                                    <input type="text" id="comercioName" required>
                                </div>
                                <div class="form-group">
                                    <label for="comercioOrder">Orden (menor número aparece primero)</label>
                                    <input type="number" id="comercioOrder" value="999">
                                </div>
                                <div class="form-group">
                                    <label for="comercioShortDescription">Descripción Corta</label>
                                    <input type="text" id="comercioShortDescription">
                                </div>
                                <div class="form-group">
                                    <label for="comercioSchedule">Horario</label>
                                    <input type="text" id="comercioSchedule">
                                </div>
                                <div class="form-group">
                                    <label for="comercioPhoneNumber">Teléfono</label>
                                    <input type="tel" id="comercioPhoneNumber">
                                </div>
                                <div class="form-group">
                                    <label for="comercioWebsite">Sitio Web</label>
                                    <input type="url" id="comercioWebsite">
                                </div>
                                <div class="form-group">
                                    <label for="comercioExternalLink">Enlace Externo (ej. PedidosYa)</label>
                                    <input type="url" id="comercioExternalLink">
                                </div>
                                <div class="form-group">
                                    <label for="comercioGoogleMapsLocation">Ubicación (URL de Google Maps)</label>
                                    <input type="url" id="comercioGoogleMapsLocation">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="comercioFullDescription">Descripción Completa</label>
                                <textarea id="comercioFullDescription"></textarea>
                            </div>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="comercioMainImage">URL Imagen Principal</label>
                                    <input type="url" id="comercioMainImage">
                                    <div class="image-preview" id="mainImagePreview"></div>
                                </div>
                                <div class="form-group">
                                    <label for="comercioAdditionalPhotos">URLs Fotos Adicionales (separadas por coma)</label>
                                    <input type="text" id="comercioAdditionalPhotos">
                                    <div class="image-preview" id="additionalPhotosPreview"></div>
                                </div>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="showInSite">
                                <label for="showInSite">Mostrar en el sitio principal</label>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="cancel" id="cancelComercioEdit">Cancelar</button>
                                <button type="submit">Guardar Comercio</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="products" class="tab-content">
                    <div class="action-buttons-container">
                        <button id="openAddProductModal">Añadir Nuevo Producto</button>
                        <button id="openAddCategoryFromProductTabModal">Añadir Nueva Categoría</button>
                    </div>
                    <div class="list-section">
                        <h2>Lista de Productos</h2>
                        <div id="productsList" class="list-grid"></div>
                    </div>
                </div>

                <div id="categories" class="tab-content">
                    <div class="form-section">
                        <h2>Añadir/Editar Categoría</h2>
                        <form id="categoryForm">
                            <input type="hidden" id="categoryId">
                            <div class="form-group">
                                <label for="categoryName">Nombre de la Categoría</label>
                                <input type="text" id="categoryName" required>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="cancel" id="cancelCategoryEdit">Cancelar</button>
                                <button type="submit">Guardar Categoría</button>
                            </div>
                        </form>
                    </div>
                    <h3>Categorías Existentes:</h3>
                    <div id="categoriesList"></div>
                </div>

                <div id="usuarios" class="tab-content">
                    <h2>Gestión de Usuarios</h2>
                    <p>Esta sección está en construcción. Aquí podrás gestionar los usuarios permitidos.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Añadir Nuevo Producto</h2>
                <span class="close-button" data-modal="addProductModal">&times;</span>
            </div>
            <form id="addProductForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="newProductName">Nombre</label>
                        <input type="text" id="newProductName" required>
                    </div>
                    <div class="form-group">
                        <label for="newProductPrice">Precio</label>
                        <input type="number" step="0.01" id="newProductPrice" required>
                    </div>
                    <div class="form-group">
                        <label for="newProductOldPrice">Precio Anterior (Opcional)</label>
                        <input type="number" step="0.01" id="newProductOldPrice">
                    </div>
                    <div class="form-group">
                        <label for="newProductOrder">Orden</label>
                        <input type="number" id="newProductOrder" value="999">
                    </div>
                </div>
                <div class="form-group">
                    <label for="newProductImage">URL de la Imagen</label>
                    <input type="url" id="newProductImage">
                </div>
                <div class="form-group">
                    <label for="newProductDetails">Detalles</label>
                    <textarea id="newProductDetails"></textarea>
                </div>
                <div class="form-group">
                    <label for="newProductCategories">Categorías</label>
                    <select id="newProductCategories" multiple style="min-height: 100px;"></select>
                </div>
                <div class="form-grid">
                    <div class="checkbox-group">
                        <input type="checkbox" id="newIsVegan">
                        <label for="newIsVegan">Vegano</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="newIsVegetarian">
                        <label for="newIsVegetarian">Vegetariano</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="newIsGlutenFree">
                        <label for="newIsGlutenFree">Sin Gluten</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newProductDietaryInfo">Info Dietética Adicional</label>
                    <input type="text" id="newProductDietaryInfo">
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel" data-modal="addProductModal">Cancelar</button>
                    <button type="submit">Añadir Producto</button>
                </div>
            </form>
        </div>
    </div>

    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Producto</h2>
                <span class="close-button" data-modal="editProductModal">&times;</span>
            </div>
            <form id="editProductForm">
                <input type="hidden" id="editProductId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editProductName">Nombre</label>
                        <input type="text" id="editProductName" required>
                    </div>
                    <div class="form-group">
                        <label for="editProductPrice">Precio</label>
                        <input type="number" step="0.01" id="editProductPrice" required>
                    </div>
                    <div class="form-group">
                        <label for="editProductOldPrice">Precio Anterior (Opcional)</label>
                        <input type="number" step="0.01" id="editProductOldPrice">
                    </div>
                    <div class="form-group">
                        <label for="editProductOrder">Orden</label>
                        <input type="number" id="editProductOrder" value="999">
                    </div>
                </div>
                <div class="form-group">
                    <label for="editProductImage">URL de la Imagen</label>
                    <input type="url" id="editProductImage">
                </div>
                <div class="form-group">
                    <label for="editProductDetails">Detalles</label>
                    <textarea id="editProductDetails"></textarea>
                </div>
                <div class="form-group">
                    <label for="editProductCategories">Categorías</label>
                    <select id="editProductCategories" multiple style="min-height: 100px;"></select>
                </div>
                <div class="form-grid">
                    <div class="checkbox-group">
                        <input type="checkbox" id="editIsVegan">
                        <label for="editIsVegan">Vegano</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="editIsVegetarian">
                        <label for="editIsVegetarian">Vegetariano</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="editIsGlutenFree">
                        <label for="editIsGlutenFree">Sin Gluten</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editProductDietaryInfo">Info Dietética Adicional</label>
                    <input type="text" id="editProductDietaryInfo">
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel" data-modal="editProductModal">Cancelar</button>
                    <button type="submit">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Añadir Nueva Categoría</h2>
                <span class="close-button" data-modal="addCategoryModal">&times;</span>
            </div>
            <form id="addCategoryForm">
                <div class="form-group">
                    <label for="newCategoryName">Nombre de la Categoría</label>
                    <input type="text" id="newCategoryName" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel" data-modal="addCategoryModal">Cancelar</button>
                    <button type="submit">Añadir Categoría</button>
                </div>
            </form>
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authModalTitle">Iniciar Sesión / Registrarse</h2>
                <span class="close-button" data-modal="authModal">&times;</span>
            </div>
            <form id="authForm">
                <div class="form-group">
                    <label for="authEmail">Email</label>
                    <input type="email" id="authEmail" required>
                </div>
                <div class="form-group">
                    <label for="authPassword">Contraseña</label>
                    <input type="password" id="authPassword" required>
                </div>
                <div class="form-actions">
                    <button type="button" id="signInButton">Iniciar Sesión</button>
                    <button type="button" id="signUpButton">Registrarse</button>
                </div>
                <p id="authError" style="color: var(--danger-color); text-align: center; margin-top: 10px; display: none;"></p>
            </form>
        </div>
    </div>

    <div id="messageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="messageModalTitle"></h2>
                <span class="close-button" data-modal="messageModal">&times;</span>
            </div>
            <p id="messageModalText"></p>
            <button class="cancel" data-modal="messageModal">Aceptar</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
